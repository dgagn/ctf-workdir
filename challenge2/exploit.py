#!/usr/bin/env python

from pwn import *

data = "./data.json"


validChars = list('0123456789abcdef')

def writeFlag(flag):
    f = open(data, "w")
    f.write('{"flag": \"' + flag + '\"}')
    f.close()

def main():
    # eval -d ./challenge2.rego -i ./data.json data.challenge2
    
    for char in validChars:
        flag = "FLAG-690c052231c2caff9b" + char
        writeFlag(flag)
        r = process(['./opa', 'eval', '-d', './challenge3.rego', '-i', './data.json', 'data'])
        resp = r.recvall()
        nocheck = resp.replace(b'check_flag', b'')
        if b'"correct_flagect_flag": true' in nocheck:
            print("DONE")
            print(flag)
            break
        if not b"check" in nocheck:
            print(nocheck)
            print(flag)
            break
main()