#!/usr/bin/env python

from pwn import *
from itertools import product

data = "./data.json"

validChars = 'yn-hulbtimwcoe'

def writeFlag(flag):
    f = open(data, "w")
    f.write('{"flag": \"FLAG-' + flag + '\"}')
    f.close()

def main():
    valid = False
    for i in product(validChars, repeat = 8):
        possibleFlag = ''.join(i)
        writeFlag(possibleFlag)
        r = process(['./opa', 'eval', '-d', './challenge3.rego', '-i', './data.json', 'data'])
        resp = r.recvall()
        r.close()
        if b'"correct_flag": true' in resp:
            print("DONE")
            print(possibleFlag)
            valid = True
            break
    if valid:
        print("DONE")
        return
main()